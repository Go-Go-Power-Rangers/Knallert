on:
  issues:
    types: [edited]

jobs:
  testing:
    name: issue edited
    runs-on: ubuntu-latest
    steps: 
      - run: |
          echo "edit on issue: $ISSUE"
        env:
          ISSUE: ${{ github.event.issue.number }}
      - uses: actions/github-script@v6
        with:
          script: |
            console.log(context.payload.changes.body.from + "\n")
            console.log(context.payload.issue.body)
            const sender = context.payload.sender.login
            const tasksBefore = context.payload.changes.body.from.match(/(- \[[x\s]\].+)/g)
            const tasksAfter = context.payload.issue.body.match(/(- \[[x\s]\].+)/g)

            if(!tasksAfter){
              console.log("No tasks list were found")
              return
            }
            
            const updatedTasks = []
            for(let task of tasksAfter) {
              if (!tasksBefore.includes(task) || !tasksBefore) {
                let taskStatus = task.includes("[x]") ? "complete" : "incomplete"
                updatedTasks.push(`@${sender} marked the checklist item *${task.split("]")[1].trim()}* as ${taskStatus} TODO (timestamp)`)
                
              }
            }
            console.log(updatedTasks)
            console.log("finish")
